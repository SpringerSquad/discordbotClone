{% extends "base.html" %}
{% block title %}Benutzerverwaltung{% endblock %}
{% block content %}
<div class="container">
  <h2 class="text-2xl font-bold mb-4">Benutzerverwaltung</h2>

  {% if success %}
    <div class="alert success">{{ success }}</div>
  {% endif %}
  {% if error %}
    <div class="alert error">{{ error }}</div>
  {% endif %}

  <div class="grid grid-2 gap-6">
    <div class="card">
      <h3 class="text-xl font-semibold mb-3">Neuen Benutzer anlegen</h3>
      <form method="post" action="/admin/users">
        <label>Benutzername</label>
        <input type="text" name="username" required>

        <label>Passwort</label>
        <input type="password" name="password" required>

        <label>Rolle</label>
        <select name="role">
          {% for r in roles %}
            <option value="{{ r }}">{{ r|capitalize }}</option>
          {% endfor %}
        </select>

        <label>Discord-ID (optional)</label>
        <input type="text" name="discord_id" placeholder="z. B. 123456789012345678">

        <div class="mt-3">
          <button class="btn btn-primary" type="submit">Anlegen</button>
        </div>
      </form>
    </div>

    <div class="card">
      <h3 class="text-xl font-semibold mb-3">Benutzerliste</h3>
      <div class="table-responsive">
        <table class="table">
          <thead>
            <tr>
              <th>ID</th>
              <th>Benutzername</th>
              <th>Rolle</th>
              <th>Discord-ID</th>
              <th>Aktionen</th>
            </tr>
          </thead>
          <tbody>
            {% for u in users %}
            <tr>
              <td>{{ u.id }}</td>
              <td>{{ u.username }}</td>
              <td>{{ u.role.value }}</td>
              <td>{{ u.discord_id or "—" }}</td>
              <td class="flex gap-2">
                <a class="btn" href="/admin/users/edit/{{ u.id }}">Bearbeiten</a>
                <a class="btn" href="/admin/users/{{ u.id }}/documents">Dokumente</a>
                <form method="post" action="/admin/users/delete/{{ u.id }}" onsubmit="return confirm('Benutzer {{ u.username }} wirklich löschen?');" style="display:inline;">
                  <button class="btn btn-danger" type="submit">Löschen</button>
                </form>
              </td>
            </tr>
            {% endfor %}
            {% if not users or users|length == 0 %}
            <tr><td colspan="5" class="muted">Keine Benutzer gefunden.</td></tr>
            {% endif %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<style>
  .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; }
  @media (max-width: 900px){ .grid-2 { grid-template-columns: 1fr; } }
  .table td .btn { margin-right: .25rem; }
  .alert { padding: .6rem .9rem; border-radius: 6px; margin-bottom: .75rem; }
  .alert.success { background: #e7f6ec; color: #256d3c; }
  .alert.error { background: #fde8e8; color: #912d2d; }
  input, select { width: 100%; padding: .5rem; border: 1px solid #ddd; border-radius: 6px; margin-bottom: .6rem; }
  .btn { border: none; padding: .45rem .8rem; border-radius: 6px; cursor: pointer; background: #eee; text-decoration:none; display:inline-block; }
  .btn-primary { background: #007bff; color: #fff; }
  .btn-danger { background: #dc3545; color: #fff; }
  .muted { color: #6b7280; }
  .flex { display: flex; align-items: center; flex-wrap: wrap; gap: 0.25rem; }
  .gap-2 { gap: 0.5rem; }
</style>
{% endblock %}
